<html xmlns xmlns:th="http://www.w3.org/1999/xhtml" : th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.ney.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout1}"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<head>

    <title>Board</title>
    <meta http-equiv="Content-Type" content="text/html" ; charset="UTF-8"/>
</head>
<body>

<div layout:fragment="content">
    <div class="panel-body">
        <div style="display: inline-block; width: 20%" >
            [[${#authentication.name}]]

            <img class="rounded" style="width: 700px;height: 600px" th:src="@{'/img/' + ${view.productUrl}}">

        </div>
        <div style="display: inline-block; align-content:center;width: 700px; margin-top: 20px; float: right">
            <label th:text="${view.productTitle}"></label>
            <hr>
            <p>[[${view.productContent}]]</p>
            정가 : <del th:text="${view.productPrice}*2"></del><br>
            판매가 : [[${view.productPrice}]]<br>
            브랜드 : Atelier<br>
            원산지 : 한국<br>
            배송 : 수도권 무료 배송 , 제주 및 산간지역 +5000원 <br>
            <hr>


            <form id="f1" th:action="@{cart}" method="post">
                <input type="hidden" name="pid" th:value="${view.pid}">
                <input type="hidden" name="uid" th:value="${#authentication.name}">
                수량 : <input type="number" name="quantity" min="1" max="1" id="selectQuantity" value="1" >
                <input type="hidden" name="cartUrl" th:value="${view.productUrl}">
            </form>
            <form id="f2" th:action="@{order_form}" method="post">
                <input type="hidden" name="oid" th:value="${view.pid}">
                <input type="hidden" name="uid" th:value="${#authentication.name}">
            </form>
            <div id="totalPriceText">
            </div>
            <button id="cartBtn" class="btn btn-outline-primary btn-sm">장바구니 담기</button>
            <button id="buyBtn" class="btn btn-outline-primary btn-sm">구매</button>
        </div>

        <p>리뷰</p>

        <div sec:authorize="isAuthenticated()">
            <hr>
            <p>댓글 작성</p>
            <input type="text" class="form-control" th:value="${#authentication.name}" readonly="readonly"
                   id="inputReplier">
            <div>
                <textarea rows="3" cols="30" class="form-control" id="inputReply"
                          style="width: 93%;display: inline"></textarea>
                <button class="btn btn-primary btn-sm pull-right btn-sm" id="addReply"
                        style="display: inline; width: 6.5%;height: 85px; margin-bottom: 78px">작성
                </button>
            </div>
        </div>

        <div style="width: 100%" id="reviewZone">        </div>
    </div>
</div>


<th:block layout:fragment="script">
    <script th:inline="javascript" th:src="@{'/js/review.js'}"></script>
    <script th:inline=javascript>

        $(document).on("ready",function (e) {
            var updateTotalPrice;
            updateTotalPrice=$('#selectQuantity').val() * [[${view.productPrice}]];
            var s= '총 결제 금액 : '+ updateTotalPrice;
            $("#totalPriceText").html(s)
            reviewManager.getAll([[${view.pid}]],reviewList);

            function reviewList(list) {
                var str="";
                for(var i=0; i<list.length; i++)
                {
                    var listValue=list[i];
                    str = str + "<p><span class='badge badge-pill badge-info'>작성자</span> :"+listValue.uid+"<br>상품 : "+[[${view.productTitle}]]+"</p>"+
                            "<textarea rows='5'style='width: 80%; background-color: white' readonly='readonly'>"
                        +listValue.content+"</textarea><hr>";

                }
                $("#reviewZone").html(str);
            }
            var obj;
            $(document).on("click", "#addReply", function (e) {
                var send_reply_text = $("#inputReply").val();
                var send_replier = $("#inputReplier").val();
                obj = {pid: [[${view.pid}]], uid: send_replier, content: send_reply_text};
                reviewManager.add(obj, reviewList);
                $("#inputReply").val("");
            });

            var fo= $("#f1");
            var productPrice=[[${view.productPrice}]];
            $(document).on("click","#selectQuantity",function (e) {
                updateTotalPrice= productPrice*(this).value;
                var s= '총 결제 금액 : '+ ( updateTotalPrice);
                $("#totalPriceText").html(s)
            });
            $(document).on("click","#cartBtn", function (e) {
                fo.append("<input type='hidden' name='totalPrice' value='" +updateTotalPrice + "'>");
                fo.submit();

            });
            $(document).on("click","#buyBtn", function (e) {
               var fo2= $("#f2");
               fo2.submit();
               //눌렀을 때 input number의 값을 보내주어야 함.
            });

        })


    </script>
</th:block>


</body>
