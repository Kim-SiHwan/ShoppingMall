<html xmlns xmlns:th="http://www.w3.org/1999/xhtml" : th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.ney.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout1}">
<head>

    <title>Board</title>
    <meta http-equiv="Content-Type" content="text/html" ; charset="UTF-8"/>
</head>
<body>

<div layout:fragment="content">
    <div class="panel-body">
        <div style="display: inline-block; width: 20%" >
            [[${#authentication.name}]]

            <img class="rounded" style="width: 700px;height: 600px" th:src="@{'/img/' + ${view.productUrl}}">

        </div>
        <div class="pull-right " style="display: inline-block; align-content:center;width: 700px; margin-top: 20px">
            <label th:text="${view.productTitle}"></label>
            <hr>
            <p>[[${view.productContent}]]</p>
            정가 : <del th:text="${view.productPrice}*2"></del><br>
            판매가 : <i th:text="${view.productPrice}"></i><br>
            적립 포인트 : <i th:text="${view.productPrice}/40"></i><br>
            브랜드 : Atelier<br>
            원산지 : 한국<br>
            배송 : 수도권 무료 배송 , 제주 및 산간지역 +5000원 <br>
            <hr>


            <form id="f1" th:action="@{bucket}" method="post">
                <input type="hidden" name="pid" th:value="${view.pid}">
                <input type="hidden" name="uid" th:value="${#authentication.name}">
                수량 : <input type="number" name="quantity" min="1" id="selectQuantity" >
                <input type="hidden" name="bucketUrl" th:value="${view.productUrl}">
            </form>
            <form id="f2" th:action="@{order_form}" method="post">
                <input type="hidden" name="pid" th:value="${view.pid}">
                <input type="hidden" name="uid" th:value="${#authentication.name}">
            </form>
            <div id="totalPriceText">
            </div>
            <button id="bucketBtn" class="btn btn-primary btn-sm">장바구니 담기</button>
            <button id="buyBtn" class="btn btn-primary btn-sm">구매</button>
        </div>
        <p>리뷰</p>
        <div style="width: 100%" id="reviewZone">

        </div>
    </div>
</div>


<th:block layout:fragment="script">
    <script th:inline="javascript" th:src="@{'/js/review.js'}"></script>
    <script th:inline=javascript>

        $(document).on("ready",function (e) {

            reviewManager.getAll([[${view.pid}]],reviewList);

            function reviewList(list) {
                var ss="";
                for(var i=0; i<list.length; i++)
                {
                    var listValue=list[i];

                    ss = ss + "<p>리뷰 번호 : "+listValue.rno+" 상품 : "+[[${view.productTitle}]]+"</p>"+"<hr>"+
                            "<textarea rows='5'style='width: 80%; background-color: white' readonly='readonly'>"
                        +listValue.content+"</textarea>";

                }
                $("#reviewZone").html(ss);
                console.log(ss);

            }

            var fo= $("#f1");
            var productPrice=[[${view.productPrice}]];
            var updateTotalPrice;
            $(document).on("click","#selectQuantity",function (e) {
                updateTotalPrice= productPrice*(this).value;
                var s= '총 결제 금액 : '+ ( updateTotalPrice);
                $("#totalPriceText").html(s)
            })
            $(document).on("click","#bucketBtn", function (e) {
                fo.append("<input type='hidden' name='totalPrice' value='" +updateTotalPrice + "'>");
                fo.submit();

            });
            $(document).on("click","#buyBtn", function (e) {
               var fo2= $("#f2");
               fo2.submit();
            });
        })


    </script>
</th:block>


</body>
